---
title: "Análisis de Regresión Lineal para Evaluar el Desempeño Térmico de Equipos en Torres de Enfriamiento"
author: "Sebastian Marinovic Leiva"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: true
    toc_depth: 2
    number_sections: true
    theme: cerulean
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Resumen Ejecutivo
Este informe presenta un análisis de regresión lineal para predecir la variable Delta Agua (diferencia de temperatura del agua en la torre de enfriamiento).

## Las variables predictoras utilizadas son:
- Temp Entrada Agua Torre: temperatura de entrada del agua
- Estado: estado del equipo (En Servicio, Mantención)
- Equipo: código del equipo (EP-110 A a F)

## Resultados clave:
- El modelo explica el 54% de la variabilidad en la respuesta (R² = 0.54).
- El estado en mantención reduce significativamente el rendimiento térmico.
- Los equipos B, D, E y F presentan mayor Delta Agua que el equipo base A.

# Carga de Librerías y Datos
```{r}
library(tidyverse)
library(broom)
library(car)
library(lmtest)
```

# Preparación de Datos
```{r}
data <- read_csv("data.csv")

# Conversión de variables categóricas
data <- data %>%
  mutate(
    Estado = as.factor(Estado),
    Equipo = as.factor(Equipo)
  )

```

# Modelo Base
```{r}
# Ajustar modelo
modelo_lm <- lm(`Delta Agua` ~ `Temp Entrada Agua Torre` + Estado + Equipo, data = data)

# Ver resumen del modelo
summary(modelo_lm)

```

## Interpretación de coeficientes:
- Temp Entrada Agua Torre: por cada grado extra, el Delta Agua disminuye 0.12°C. (efecto negativo)
- EstadoMantención: reduce el Delta Agua en 6.33°C respecto a "En Servicio".
- Equipos B, D, E y F muestran mejor rendimiento térmico que A (coeficientes positivos y significativos).


# Visualización de coeficientes del modelo
```{r}
coef_plot <- tidy(modelo_lm) %>%
  filter(term != "(Intercept)")

ggplot(coef_plot, aes(x = reorder(term, estimate), y = estimate)) +
  geom_point(size = 3, color = "steelblue") +
  geom_errorbar(aes(ymin = estimate - std.error, ymax = estimate + std.error), width = 0.2) +
  coord_flip() +
  labs(title = "Efectos Estimados de las Variables", x = "Variable", y = "Coeficiente estimado (±1 SE)") +
  theme_minimal()

```

## Interpretación
- El estado en mantención y los equipos B y D tienen el mayor impacto en el Delta Agua. Las barras de error estrechas indican confianza en la estimación.

# Comparación de valores reales vs predichos
```{r}
data_pred <- augment(modelo_lm, data)

ggplot(data_pred, aes(x = .fitted, y = `Delta Agua`)) +
  geom_point(alpha = 0.7, color = "darkgreen") +
  geom_abline(intercept = 0, slope = 1, linetype = "dashed", color = "red") +
  labs(title = "Valores Reales vs. Predichos", x = "Predicho", y = "Observado") +
  theme_minimal()

```

## Interpretación
- El modelo se ajusta adecuadamente. La mayoría de los puntos están cerca de la línea ideal. Se observa cierta variabilidad no explicada, pero sin sesgos aparentes.
- Este gráfico permite evaluar qué tan bien se ajusta el modelo.
- Si los puntos caen cerca de la línea roja diagonal, significa que el modelo predice correctamente.
- Una dispersión moderada, como se observa, es típica en datos reales y refleja la variabilidad que el modelo no puede capturar del todo.

# Diagnósticos de Supuestos
## Linealidad y Homocedasticidad
```{r}
plot(modelo_lm, which = 1)  # residuos vs ajustados
```

### Observación
- No se aprecian patrones claros, lo que sugiere que la relación es aproximadamente lineal y la varianza constante.

## Normalidad de Residuos
```{r}
plot(modelo_lm, which = 2)  # Q-Q plot
shapiro.test(residuals(modelo_lm))
```

### Interpretación
- El test de Shapiro-Wilk y el gráfico Q-Q sugieren una distribución aproximadamente normal de los residuos. No se rechaza la normalidad (p = 0,2205)

## Heterocedasticidad (Breusch-Pagan)
```{r}
bptest(modelo_lm)
```
### Interpretación
- p-value > 0.05 → no hay evidencia significativa de heterocedasticidad.

## Multicolinealidad
```{r}
vif(modelo_lm)
```
### Interpretación
- Todos los VIF < 5 → no hay colinealidad preocupante entre predictores.

# Modelo con Interacción 
```{r}
modelo_inter <- lm(`Delta Agua` ~ `Temp Entrada Agua Torre` * Estado + Equipo, data = data)
summary(modelo_inter)
```
## Comparación con Modelo Base
```{r}
anova(modelo_lm, modelo_inter)
```

## Resultado
- Se compara el modelo base con uno que incluye la interacción entre temperatura de entrada y estado del equipo.
Los resultados muestran que la interacción no aporta mejora alguna al ajuste del modelo (RSS idéntico, sin diferencia en grados de libertad), lo que indica que el efecto de la temperatura sobre el Delta Agua es independiente del estado del equipo. Por lo tanto, se mantiene el modelo base por ser más parsimonioso y ofrecer el mismo poder explicativo..

# Facetas por Estado (Observado vs Predicho)
```{r}
augment(modelo_lm, data) %>%
  ggplot(aes(x = .fitted, y = `Delta Agua`)) +
  geom_point(alpha = 0.6) +
  geom_abline(slope = 1, intercept = 0, color = "red", linetype = "dashed") +
  facet_wrap(~ Estado) +
  theme_minimal() +
  labs(title = "Predicción por Estado del Equipo", x = "Valor predicho de Delta Agua (°C)", y = "Observado")
```

## Interpretación 
- El modelo diferencia correctamente los comportamientos térmicos entre equipos en servicio y en mantención. Predice con mayor precisión en el estado operativo normal, mientras que en estado de mantención refleja adecuadamente la baja actividad térmica. Esta segmentación valida la inclusión del estado del equipo como variable categórica clave en el modelo.


# Conclusión Final
- El modelo de regresión lineal desarrollado presenta una capacidad sólida para explicar el comportamiento térmico del sistema de enfriamiento, utilizando variables operacionales relevantes. Se validan todos los supuestos estadísticos requeridos para este tipo de análisis, y las variables seleccionadas resultan significativas y coherentes con la lógica física del proceso.
- Las visualizaciones incorporadas permiten comunicar de manera clara y efectiva los hallazgos del modelo, facilitando su interpretación. En consecuencia, se considera que este modelo puede integrarse a sistemas de monitoreo y apoyo a la toma de decisiones, contribuyendo a la priorización de tareas de mantenimiento y a la optimización del rendimiento térmico en contextos industriales.
